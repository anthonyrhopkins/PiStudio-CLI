kind: AdaptiveDialog

# Creates the initial report file with header when research begins
# Called by initialize_research topic after gathering company info

beginDialog:
  kind: OnInvokeActivity
  id: main

  actions:
    - kind: ConditionGroup
      id: checkCompanySet
      conditions:
        - id: noCompany
          condition: =IsBlank(Global.CompanyName)
          actions:
            - kind: SetVariable
              id: setError
              variable: Topic.Result
              value: "error: Global.CompanyName not set"

        - id: hasCompany
          condition: =!IsBlank(Global.CompanyName)
          actions:
            # Build initial report header
            - kind: SetVariable
              id: setReportHeader
              variable: Topic.ReportHeader
              value: |
                =Concatenate(
                  "# ", Global.CompanyName, " - Company Intelligence Report", Char(10), Char(10),
                  "**Generated by:** My Copilot Company Intelligence", Char(10),
                  "**Date:** ", Text(Now(), "MMMM d, yyyy"), Char(10),
                  "**Domain:** ", Global.Domain, Char(10),
                  "**Ticker:** ", If(IsBlank(Global.Ticker), "Private Company", Global.Ticker), Char(10), Char(10),
                  "---", Char(10), Char(10),
                  "## Table of Contents", Char(10),
                  "1. Company Overview (Phase 0-2)", Char(10),
                  "2. Leadership Team (Phase 3)", Char(10),
                  "3. Industry Analysis (Phase 4)", Char(10),
                  "4. Financial Performance (Phase 5)", Char(10),
                  "5. Intelligence Collection (Phase 6)", Char(10),
                  "6. Growth Propensity Score (Phase 7-8)", Char(10), Char(10),
                  "---", Char(10), Char(10)
                )

            # Create new file with header (overwrites if exists)
            - kind: BeginDialog
              id: createReportFile
              dialog: my_bot.action.Create_Report_File
              input:
                file_name: =Concatenate(Global.CompanyName, "_Research_Report.md")
                folder_path: /Research Reports
                initial_content: =Topic.ReportHeader
                company_name: =Global.CompanyName

            # Store file reference for later appends
            - kind: SetVariable
              id: setReportPath
              variable: Global.ReportFilePath
              value: =Concatenate("/Research Reports/", Global.CompanyName, "_Research_Report.md")

            - kind: SetVariable
              id: setSuccess
              variable: Topic.Result
              value: =Concatenate("success: Report initialized at ", Global.ReportFilePath)

            - kind: SendActivity
              id: confirmInit
              activity: |
                ðŸ“„ Research report initialized: {Global.CompanyName}_Research_Report.md
                Findings will be appended as each phase completes.

inputType:
  properties: {}

outputType:
  properties:
    Result:
      type: String
      displayName: Operation Result
